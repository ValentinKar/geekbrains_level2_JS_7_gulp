function Basket(t){this.id=t,this.countGoods=0,this.amount=0,this.basketItems=[],this.getBasket()}function Comment(t){this.id=t,this.idDivForReviews="reviews",this.commentsArray=[],this.getReviews()}function Good(t,e,o){this.id=t,this.title=e,this.price=o}Basket.prototype.render=function(t){var e=$("<div />",{id:this.id,text:"Корзина"});$("<div />",{id:this.id+"_items"}).appendTo(e),e.appendTo(t)},Basket.prototype.getBasket=function(){var t="#"+this.id+"_items";$.ajax({type:"GET",url:"./basket.json",dataType:"json",context:this,success:function(e){var o=$("<div />",{id:"basket_data"});this.countGoods=e.basket.length,this.amount=e.amount,o.append("Всего товаров: "+this.countGoods+"</p>"),o.append("Общая стоимость: "+this.amount+"</p>"),o.appendTo(t);for(var i in e.basket)this.basketItems.push(e.basket[i])}})},Basket.prototype.add=function(t,e){var o={id_product:t,price:e};this.amount+=e,this.countGoods++,this.basketItems.push(o),this.refresh()},Basket.prototype.refresh=function(){var t=$("#basket_data");t.empty(),t.append("Всего товаров: "+this.countGoods+"</p>"),t.append("Общая стоимость: "+this.amount+"</p>")},Basket.prototype.remove=function(t){var e=this.find(t);if(e){this.basketItems.splice(e,1);var o=this.summa(t);this.amount=o[1],this.countGoods=o[0]}this.refresh()},Basket.prototype.find=function(t){var e=!1;return this.basketItems.forEach(function(o,i){o.id_product===t&&(e=i)}),e},Basket.prototype.summa=function(){var t=0,e=0;return this.basketItems.forEach(function(o){++t,e+=o.price}),[t,e]},Comment.prototype.render=function(t){var e=$("<div />",{id:this.id,text:"Добавить отзыв от пользователя с id = "}),o=$("<input />",{id:this.id+"_user",value:"12"}),i=$("<div />");$("<textarea />",{id:this.id+"_review",cols:40,rows:10}).appendTo(i);var n=$("<button />",{class:"add-comment",text:"добавить","data-id":this.id+"_add"}),s=$("<div />",{id:this.idDivForReviews});o.appendTo(e),i.appendTo(e),n.appendTo(e),e.appendTo(t),t.append("<hr />"),t.append("Отзывы: </p>"),s.appendTo(t)},Comment.prototype.getReviews=function(){$.ajax({type:"GET",url:"./reviews.json",dataType:"json",context:this,success:function(t){1===t.result&&(this.reviewsArray(t.comments),this.showReviews())}})},Comment.prototype.reviewsArray=function(t){for(var e in t)this.commentsArray.push(t[e])},Comment.prototype.showReviews=function(){var t="#"+this.idDivForReviews,e=$("<div />",{});this.commentsArray.forEach(function(t,o){var i=$("<div />",{class:"review-div"}),n=$("<button />",{class:"comment-delete",text:"Удалить комментарий","review-id-for-delete":t.id_comment}),s=$("<button />",{class:"comment-approve",text:"Одобрить комментарий","review-id-for-approve":t.id_comment});i.append("id comment: "+t.id_comment+"</p>"),i.append("result: "+t.result+"</p>"),i.append("id пользователя: "+t.id_user+"</p>"),i.append("текст комментария: "+t.text+"</p>"),i.append("состояние отзыва: "+t.error_message+"</p>"),i.append(n),i.append(s),e.append(i)}),e.appendTo(t)},Comment.prototype.findIndComment=function(){var t=this.commentsArray[this.commentsArray.length-1].id_comment;return++t},Comment.prototype.add=function(t,e){var o={id_comment:this.findIndComment(),result:1,id_user:t,text:e,error_message:"Ваш отзыв был отправлен на модерацию"};this.commentsArray.push(o),this.refresh()},Comment.prototype.refresh=function(){$("#"+this.idDivForReviews).empty(),this.showReviews()},Comment.prototype.remove=function(t){var e=this.find(t);e&&this.commentsArray.splice(e,1),this.refresh()},Comment.prototype.find=function(t){var e=!1;return this.commentsArray.forEach(function(o,i){o.id_comment===t&&(e=i)}),e},Comment.prototype.approve=function(t){var e=this.find(t);e&&(this.commentsArray[e].result=2,this.commentsArray[e].error_message="Ваш отзыв одобрен"),this.refresh()},Good.prototype.render=function(t){var e=$("<div />",{class:"good"}),o=$("<p />",{text:this.title}),i=$('<p>Цена: <span class="product-price">'+this.price+"</span> руб.</p>"),n=$("<button />",{class:"good-buy",text:"Купить","data-id":this.id}),s=$("<button />",{class:"good-delete",text:"Удалить из корзины","data-id":this.id});o.appendTo(e),i.appendTo(e),n.appendTo(e),s.appendTo(e),t.append(e)},$(document).ready(function(){var t=$("#goods");console.log(t),new Good(123,"Клавиатура для ПК",800).render(t),new Good(124,"Мышь для ПК1",700).render(t);var e=new Basket("basket");e.render($("#basket_wrapper")),$(".good-buy").on("click",function(){var t=parseInt($(this).attr("data-id")),o=parseInt($(this).parent().find("span.product-price").text());e.add(t,o)}),$(".good-delete").on("click",function(){var t=parseInt($(this).attr("data-id")),o=parseInt($(this).parent().find("span.product-price").text());e.remove(t,o)});var o="comments",i=new Comment(o);i.render($("#users-comments")),$(".add-comment").on("click",function(){var t=parseInt($("#"+o+"_user").val()),e=$("#"+o+"_review").val();i.add(t,e)}),$(document).on("click",".comment-delete",function(){var t=parseInt($(this).attr("review-id-for-delete"));i.remove(t)}),$(document).on("click",".comment-approve",function(){var t=parseInt($(this).attr("review-id-for-approve"));i.approve(t)})});